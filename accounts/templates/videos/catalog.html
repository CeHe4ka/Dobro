{% extends 'base.html' %}
{% load dict_filters %}

{% block content %}
<div class="container mt-4">
  <h1 class="mb-4"><i class="bi bi-film"></i> –ö–∞—Ç–∞–ª–æ–≥ –≤–∏–¥–µ–æ</h1>

  <!-- –§–æ—Ä–º–∞ –ø–æ–∏—Å–∫–∞ -->
  <form method="get" class="row g-2 mb-4 bg-light p-3 rounded shadow-sm">
    <div class="col-md-4">
      <input type="text" name="q" class="form-control" placeholder="–ü–æ–∏—Å–∫..." value="{{ query }}">
    </div>
    <div class="col-md-3">
      <input type="text" name="category" class="form-control" placeholder="–ö–∞—Ç–µ–≥–æ—Ä–∏—è" value="{{ category }}">
    </div>
    <div class="col-md-3">
      <input type="text" name="tag" class="form-control" placeholder="–¢–µ–≥–∏" value="{{ tag }}">
    </div>
    <div class="col-md-2">
      <button type="submit" class="btn btn-primary w-100">–ù–∞–π—Ç–∏</button>
    </div>
  </form>

  {% if videos %}
    <div class="row">
      {% for video in videos %}
        <div class="col-md-6 col-lg-4 mb-4">
          <div class="card h-100 shadow-sm">
            <div class="card-body d-flex flex-column">
              <h5 class="card-title">{{ video.title }}</h5>
              <p class="card-text">{{ video.description|truncatechars:100 }}</p>
              <p><strong>–ê–≤—Ç–æ—Ä:</strong> {{ video.author }}</p>
              <p><strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> {{ video.category }}</p>
              <p><strong>–¢–µ–≥–∏:</strong> {{ video.tags }}</p>

              <!-- –û—Ü–µ–Ω–∫–∞ -->
              <div class="mb-2">
                {% if ratings|dict_get:video.id == 'like' %}
                  üëç –í—ã –ø–æ—Å—Ç–∞–≤–∏–ª–∏ –ª–∞–π–∫
                {% elif ratings|dict_get:video.id == 'dislike' %}
                  üëé –í—ã –ø–æ—Å—Ç–∞–≤–∏–ª–∏ –¥–∏–∑–ª–∞–π–∫
                {% else %}
                  –ë–µ–∑ –æ—Ü–µ–Ω–∫–∏
                {% endif %}
              </div>

              <!-- –ö–Ω–æ–ø–∫–∏ –æ—Ü–µ–Ω–æ–∫ –∏ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ -->
              <div class="d-flex flex-wrap gap-2">
                <a href="{% url 'videos:rate_video' video.id 'like' %}" class="btn btn-outline-success btn-sm">üëç –õ–∞–π–∫</a>
                <a href="{% url 'videos:rate_video' video.id 'dislike' %}" class="btn btn-outline-danger btn-sm">üëé –î–∏–∑–ª–∞–π–∫</a>
                <a href="{% url 'videos:toggle_favorite' video.id %}" class="btn btn-outline-warning btn-sm">
                  {% if video.id in favorites %}
                    ‚≠ê –£–¥–∞–ª–∏—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
                  {% else %}
                    ‚òÜ –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
                  {% endif %}
                </a>
              </div>

              <div class="mt-3 d-flex justify-content-between">
                <a href="{% url 'videos:watch' video.id %}" class="btn btn-success btn-sm">–°–º–æ—Ç—Ä–µ—Ç—å</a>
                <a href="{{ video.youtube_url }}" target="_blank" class="btn btn-outline-primary btn-sm">–ù–∞ YouTube</a>
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="alert alert-info">–ü–æ–∫–∞ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤–∏–¥–µ–æ.</div>
  {% endif %}
</div>
{% endblock %}
